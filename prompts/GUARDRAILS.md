# AI Guardrails

These rules apply to **all** AI agents and assistants working on this codebase, regardless of tool or persona.

## Hard Boundaries

### Never Do
1. **Never commit secrets** — no API keys, tokens, passwords, or credentials in any file. Use environment variables or GitHub Actions secrets.
2. **Never modify CHANGELOG.md** — it is auto-generated by release-please. Manual edits will be overwritten.
3. **Never force-push to `main`** — all changes go through PRs.
4. **Never delete or overwrite test fixtures** in `testdata/` without understanding what tests depend on them.
5. **Never reduce test coverage** below 80%. If your change drops coverage, add tests before merging.
6. **Never silence linters** with `//nolint` directives unless you document the reason inline.
7. **Never add dependencies** to `go.mod` without explicit maintainer approval. tfwatch is intentionally minimal.

### Never Build
1. **Never make tfwatch a daemon or long-running service.** It runs once and exits.
2. **Never make tfwatch write to Terraform state or config files.** It is strictly read-only.
3. **Never add support for non-Terraform IaC tools.** The mission is Terraform dependency tracking.
4. **Never add a database, cache, or persistent config file.** tfwatch is stateless by design.
5. **Never add external runtime dependencies** (Redis, databases, message queues). It's a single binary.

### Never Change Without Approval
1. **Metric name** (`terraform_dependency_version`) — changing this breaks all downstream dashboards and PromQL queries.
2. **Label schema** — adding, removing, or renaming metric labels is a breaking change.
3. **CLI flag names** — renaming flags breaks existing CI/CD integrations.
4. **Release-please configuration** — the release pipeline is fragile; changes need careful testing.

## Code Quality Gates

All changes must pass before merge:

```
make lint     # golangci-lint with errcheck, govet, staticcheck, etc.
make test     # go test -race -coverprofile (80% minimum)
make build    # must compile for linux/darwin × amd64/arm64
```

## Scope Enforcement

Each agent persona has explicit file ownership boundaries defined in `prompts/CONTEXT.md`. An agent must:
- Only modify files within its ownership scope
- Delegate cross-scope changes to the appropriate agent
- Never bypass scope boundaries "just this once"

## Output Consistency

Every agent must:
- Use its defined output template for every response — no freeform answers
- Include all mandatory sections — never skip or merge sections
- Include validation checklists in implementation responses

## Review Requirements

AI-generated code should be reviewed with extra attention to:
- **Error handling** — are errors wrapped with context? Are edge cases covered?
- **Test coverage** — does the test actually assert the right behavior, or just exercise the code?
- **Scope creep** — does the change do more than what was asked?
- **Dependencies** — were any new imports or modules added?
- **Metric changes** — does this affect the published OTEL metric labels or values?
